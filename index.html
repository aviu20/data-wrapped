<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Wrapped - Your Dating Story</title>
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="Data Wrapped - Discover Your Dating Story">
    <meta property="og:description" content="Upload your Hinge data and get a Spotify Wrapped-style summary of your dating life!">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’•</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Lucide React icons as inline SVGs
        const Upload = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        );
        
        const Heart = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        );
        
        const Flame = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>
        );
        
        const MessageCircle = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
        );
        
        const Sparkles = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
        );
        
        const TrendingUp = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        );
        
        const Clock = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        
        const Zap = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        
        const User = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        );

        const DataWrappedAnalyzer = () => {
          const [file, setFile] = useState(null);
          const [analysis, setAnalysis] = useState(null);
          const [loading, setLoading] = useState(false);
          const [currentSlide, setCurrentSlide] = useState(0);

          const analyzeHingeData = async (data) => {
            console.log('Raw data structure:', data);
            
            let likes = [];
            let matches = [];
            let allChatMessages = [];
            let allItems = [];
            
            if (Array.isArray(data)) {
              allItems = data;
              likes = data.filter(item => item.like && Array.isArray(item.like));
              matches = data.filter(item => item.match && Array.isArray(item.match));
              
              data.forEach(item => {
                if (item.chats && Array.isArray(item.chats)) {
                  item.chats.forEach(chat => {
                    if (chat.body) {
                      allChatMessages.push({
                        text: chat.body,
                        timestamp: chat.timestamp
                      });
                    }
                  });
                }
              });
            } else if (typeof data === 'object') {
              likes = data.likes || data.Likes || [];
              matches = data.matches || data.Matches || [];
              
              if (data.chats && Array.isArray(data.chats)) {
                data.chats.forEach(chat => {
                  if (chat.body) {
                    allChatMessages.push({
                      text: chat.body,
                      timestamp: chat.timestamp
                    });
                  }
                });
              }
            }

            console.log('Parsed counts:', { 
              likes: likes.length, 
              matches: matches.length, 
              chatMessages: allChatMessages.length 
            });

            const totalLikes = likes.length;
            const totalMatches = matches.length;
            const likeToMatchRate = totalLikes > 0 ? ((totalMatches / totalLikes) * 100).toFixed(1) : 0;

            const activityByDay = {};
            const activityByHour = {};
            
            const allTimestamps = [];
            
            likes.forEach(item => {
              if (item.like && Array.isArray(item.like)) {
                item.like.forEach(likeObj => {
                  if (likeObj.timestamp) allTimestamps.push(likeObj.timestamp);
                });
              }
            });
            
            matches.forEach(item => {
              if (item.match && Array.isArray(item.match)) {
                item.match.forEach(matchObj => {
                  if (matchObj.timestamp) allTimestamps.push(matchObj.timestamp);
                });
              }
            });
            
            allChatMessages.forEach(msg => {
              if (msg.timestamp) allTimestamps.push(msg.timestamp);
            });
            
            allTimestamps.forEach(timestamp => {
              const date = new Date(timestamp);
              if (!isNaN(date.getTime())) {
                const day = date.toLocaleDateString('en-US', { weekday: 'short' });
                const hour = date.getHours();
                
                activityByDay[day] = (activityByDay[day] || 0) + 1;
                activityByHour[hour] = (activityByHour[hour] || 0) + 1;
              }
            });

            const peakDay = Object.entries(activityByDay).length > 0 
              ? Object.entries(activityByDay).sort((a, b) => b[1] - a[1])[0]
              : null;
            const peakHour = Object.entries(activityByHour).length > 0
              ? Object.entries(activityByHour).sort((a, b) => b[1] - a[1])[0]
              : null;

            const conversationsWithChats = allItems.filter(item => item.chats && item.chats.length > 0);
            const totalConversations = conversationsWithChats.length;
            const totalMessages = allChatMessages.length;
            
            let conversationLengths = conversationsWithChats.map(item => item.chats.length);
            const avgConversationLength = conversationLengths.length > 0 
              ? (conversationLengths.reduce((a, b) => a + b, 0) / conversationLengths.length).toFixed(1)
              : 0;

            const swipeFrequency = totalLikes > 30 ? 'high' : totalLikes > 10 ? 'moderate' : 'selective';
            const conversationStyle = avgConversationLength > 20 ? 'deep' : avgConversationLength > 10 ? 'balanced' : 'brief';
            const matchSuccess = likeToMatchRate > 15 ? 'high' : likeToMatchRate > 5 ? 'average' : 'selective';

            let messagingAnalysis = null;
            if (allChatMessages.length > 0) {
              messagingAnalysis = await analyzeMessagingStyle(allChatMessages);
            }

            return {
              basicStats: {
                totalLikes,
                totalMatches,
                totalConversations,
                likeToMatchRate,
                totalMessages,
                avgConversationLength
              },
              patterns: {
                peakDay: peakDay ? peakDay[0] : 'Unknown',
                peakHour: peakHour ? parseInt(peakHour[0]) : null,
                swipeFrequency,
                conversationStyle,
                matchSuccess
              },
              messagingAnalysis
            };
          };

          const analyzeMessagingStyle = async (messages) => {
            const sampleMessages = messages
              .map(m => m.text || m.body)
              .filter(Boolean)
              .slice(0, 50);
            
            if (sampleMessages.length === 0) return null;

            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1500,
                  messages: [
                    { 
                      role: "user", 
                      content: `Analyze these dating app messages from a single person and respond ONLY with a valid JSON object (no markdown, no preamble):

Messages: ${JSON.stringify(sampleMessages.slice(0, 40))}

Based on their messages, analyze what kind of person they are. Return this exact structure:
{
  "flirtScore": <number 1-10>,
  "flirtStyle": "<playful/subtle/direct/reserved>",
  "messageStyle": "<witty/genuine/intellectual/casual/playful>",
  "userPersonalityTraits": ["<trait1>", "<trait2>", "<trait3>", "<trait4>", "<trait5>"],
  "dateabilityScore": <number 1-10, where 1 = "you belong to the streets" and 10 = "you've been married for 7 lifetimes">,
  "dateabilityRoast": "<funny one-liner about their datability score>",
  "quirkyInsight": "<one fun observation about their texting style>",
  "signatureLine": "<a short phrase or opening line they seem to use often, or a made-up one that captures their style>",
  "topUsedWords": ["<word1>", "<word2>", "<word3>"]
}` 
                    }
                  ],
                })
              });

              const data = await response.json();
              const text = data.content.filter(item => item.type === 'text').map(item => item.text).join('');
              const cleaned = text.replace(/```json|```/g, '').trim();
              return JSON.parse(cleaned);
            } catch (error) {
              console.error('Messaging analysis error:', error);
              return null;
            }
          };

          const handleFileUpload = async (event) => {
            const uploadedFile = event.target.files[0];
            if (!uploadedFile) return;

            setFile(uploadedFile);
            setLoading(true);
            setAnalysis(null);
            setCurrentSlide(0);

            try {
              const text = await uploadedFile.text();
              const data = JSON.parse(text);
              const results = await analyzeHingeData(data);
              setAnalysis(results);
            } catch (error) {
              alert('Error processing file. Please ensure it\'s valid JSON format.');
              console.error(error);
            } finally {
              setLoading(false);
            }
          };

          const getQuip = (stat, value, analysis) => {
            switch(stat) {
              case 'likes':
                if (value > 100) return "Someone's been busy! ðŸ‘€";
                if (value > 50) return "Quality over quantity... right? ðŸ˜…";
                if (value > 20) return "Selective king/queen ðŸ‘‘";
                return "Playing hard to get, we see you ðŸ˜Œ";
              
              case 'matchRate':
                if (value > 20) return "Main character energy âœ¨";
                if (value > 10) return "Doing better than most! ðŸŽ¯";
                if (value > 5) return "Perfectly balanced ðŸ§˜";
                return "Quality over quantity gang ðŸ’Ž";
              
              case 'conversations':
                if (value > 50) return "Professional yapper ðŸ—£ï¸";
                if (value > 20) return "Social butterfly mode ðŸ¦‹";
                if (value > 10) return "Keeping it interesting âœ¨";
                return "Mysterious and selective ðŸŒ™";
              
              case 'avgMessages':
                if (value > 30) return "Essay writer detected ðŸ“š";
                if (value > 15) return "Actually trying! We love to see it ðŸ’¬";
                if (value > 5) return "Straight to the point âš¡";
                return "Efficiency expert ðŸŽ¯";
              
              case 'peakTime':
                const hour = analysis?.patterns?.peakHour;
                if (hour >= 22 || hour < 2) return "Night owl alert ðŸ¦‰";
                if (hour >= 2 && hour < 6) return "Insomniac energy ðŸ˜´";
                if (hour >= 12 && hour < 17) return "Lunch break romantic ðŸŒ®";
                if (hour >= 20 && hour < 22) return "Post-dinner swiper ðŸ·";
                return "Morning person?! Respect ðŸŒ…";
              
              default:
                return "Iconic behavior ðŸ’…";
            }
          };

          const formatTime = (hour) => {
            if (hour === null) return 'Unknown';
            const period = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour;
            return `${displayHour}${period}`;
          };

          const slides = analysis ? [
            {
              bg: 'from-purple-600 to-pink-600',
              content: (
                <div className="text-center text-white space-y-6">
                  <Sparkles className="w-20 h-20 mx-auto animate-pulse" />
                  <h1 className="text-6xl font-bold">Your Hinge</h1>
                  <h1 className="text-6xl font-bold">Wrapped</h1>
                  <p className="text-2xl opacity-90 pt-4">Let's see what you've been up to... ðŸ‘€</p>
                </div>
              )
            },
            {
              bg: 'from-rose-500 to-orange-500',
              content: (
                <div className="text-center text-white space-y-8">
                  <Heart className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">You sent</p>
                    <p className="text-8xl font-bold">{analysis.basicStats.totalLikes}</p>
                    <p className="text-3xl mt-4">likes this year</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4">{getQuip('likes', analysis.basicStats.totalLikes, analysis)}</p>
                </div>
              )
            },
            {
              bg: 'from-pink-600 to-purple-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <TrendingUp className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">Match rate</p>
                    <p className="text-8xl font-bold">{analysis.basicStats.likeToMatchRate}%</p>
                    <p className="text-xl mt-4 opacity-80">{analysis.basicStats.totalMatches} matches</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4">{getQuip('matchRate', parseFloat(analysis.basicStats.likeToMatchRate), analysis)}</p>
                </div>
              )
            },
            {
              bg: 'from-blue-600 to-purple-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <MessageCircle className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">You started</p>
                    <p className="text-8xl font-bold">{analysis.basicStats.totalConversations}</p>
                    <p className="text-3xl mt-4">conversations</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4">{getQuip('conversations', analysis.basicStats.totalConversations, analysis)}</p>
                </div>
              )
            },
            {
              bg: 'from-indigo-600 to-blue-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <Zap className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">Average conversation</p>
                    <p className="text-8xl font-bold">{analysis.basicStats.avgConversationLength}</p>
                    <p className="text-3xl mt-4">messages</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4">{getQuip('avgMessages', parseFloat(analysis.basicStats.avgConversationLength), analysis)}</p>
                </div>
              )
            },
            {
              bg: 'from-violet-600 to-purple-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <Clock className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">You're most active at</p>
                    <p className="text-8xl font-bold">{formatTime(analysis.patterns.peakHour)}</p>
                    <p className="text-xl mt-4 opacity-80">on {analysis.patterns.peakDay}s</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4">{getQuip('peakTime', null, analysis)}</p>
                </div>
              )
            },
            ...(analysis.messagingAnalysis ? [{
              bg: 'from-red-500 to-pink-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <Flame className="w-16 h-16 mx-auto animate-pulse" />
                  <div>
                    <p className="text-2xl mb-4">Your Flirt Score</p>
                    <p className="text-8xl font-bold">{analysis.messagingAnalysis.flirtScore}/10</p>
                    <p className="text-3xl mt-4 capitalize">{analysis.messagingAnalysis.flirtStyle}</p>
                  </div>
                  <p className="text-xl opacity-90 pt-4 px-8">
                    {analysis.messagingAnalysis.flirtScore >= 8 ? "Smooth operator ðŸ˜" :
                     analysis.messagingAnalysis.flirtScore >= 6 ? "Balanced charm âœ¨" :
                     analysis.messagingAnalysis.flirtScore >= 4 ? "Subtle and sweet ðŸ’­" :
                     "Playing it cool ðŸ˜Œ"}
                  </p>
                </div>
              )
            }] : []),
            ...(analysis.messagingAnalysis ? [{
              bg: 'from-orange-500 to-red-500',
              content: (
                <div className="text-center text-white space-y-8">
                  <MessageCircle className="w-16 h-16 mx-auto" />
                  <div>
                    <p className="text-2xl mb-4">Your texting vibe is</p>
                    <p className="text-6xl font-bold capitalize">{analysis.messagingAnalysis.messageStyle}</p>
                  </div>
                  <p className="text-xl opacity-90 pt-6 px-8">{analysis.messagingAnalysis.quirkyInsight}</p>
                </div>
              )
            }] : []),
            ...(analysis.messagingAnalysis && analysis.messagingAnalysis.signatureLine ? [{
              bg: 'from-yellow-500 to-orange-500',
              content: (
                <div className="text-center text-white space-y-8">
                  <Sparkles className="w-16 h-16 mx-auto" />
                  <div className="px-8">
                    <p className="text-2xl mb-6">Your go-to line</p>
                    <div className="bg-white/20 backdrop-blur rounded-2xl p-8 mb-6">
                      <p className="text-3xl font-bold italic">"{analysis.messagingAnalysis.signatureLine}"</p>
                    </div>
                    {analysis.messagingAnalysis.topUsedWords && analysis.messagingAnalysis.topUsedWords.length > 0 && (
                      <div className="pt-4">
                        <p className="text-lg mb-3 opacity-90">Most used words:</p>
                        <div className="flex gap-3 justify-center flex-wrap">
                          {analysis.messagingAnalysis.topUsedWords.map((word, i) => (
                            <span key={i} className="bg-white/30 px-4 py-2 rounded-full text-lg font-semibold">
                              {word}
                            </span>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )
            }] : []),
            ...(analysis.messagingAnalysis && analysis.messagingAnalysis.userPersonalityTraits ? [{
              bg: 'from-purple-600 to-indigo-600',
              content: (
                <div className="text-center text-white space-y-6 px-8">
                  <User className="w-16 h-16 mx-auto" />
                  <p className="text-3xl font-bold mb-8">You Are...</p>
                  <div className="space-y-4">
                    {analysis.messagingAnalysis.userPersonalityTraits.map((trait, i) => (
                      <div key={i} className="text-2xl font-semibold bg-white/20 rounded-full py-3 px-6 backdrop-blur">
                        {trait}
                      </div>
                    ))}
                  </div>
                </div>
              )
            }] : []),
            ...(analysis.messagingAnalysis && analysis.messagingAnalysis.dateabilityScore ? [{
              bg: 'from-green-500 to-emerald-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <Heart className="w-16 h-16 mx-auto animate-pulse" />
                  <div>
                    <p className="text-2xl mb-4">Dateability Score</p>
                    <p className="text-8xl font-bold">{analysis.messagingAnalysis.dateabilityScore}/10</p>
                    <div className="mt-6 px-8">
                      <div className="bg-white/20 backdrop-blur rounded-xl p-4">
                        <p className="text-lg italic">{analysis.messagingAnalysis.dateabilityRoast}</p>
                      </div>
                    </div>
                  </div>
                  <p className="text-sm opacity-75 pt-4 px-8">
                    {analysis.messagingAnalysis.dateabilityScore <= 3 ? "1 = you belong to the streets" :
                     analysis.messagingAnalysis.dateabilityScore >= 9 ? "10 = married for 7 lifetimes" :
                     "Somewhere between the streets and soulmates"}
                  </p>
                </div>
              )
            }] : []),
            {
              bg: 'from-pink-600 to-purple-600',
              content: (
                <div className="text-center text-white space-y-8">
                  <Heart className="w-20 h-20 mx-auto" />
                  <div>
                    <p className="text-4xl font-bold mb-6">That's a wrap!</p>
                    <p className="text-xl opacity-90 px-8">
                      {analysis.basicStats.totalMatches > 10 
                        ? "You're doing great out there! âœ¨" 
                        : "Quality over quantity, always ðŸ’Ž"}
                    </p>
                  </div>
                  <div className="pt-8 text-sm opacity-75">
                    <p>#HingeWrapped #DataWrapped</p>
                  </div>
                </div>
              )
            }
          ] : [];

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
              {!analysis ? (
                <div className="min-h-screen flex items-center justify-center p-8">
                  <div className="bg-white rounded-3xl shadow-2xl p-12 text-center max
